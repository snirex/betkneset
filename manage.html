<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ניהול סוגי הכנסה</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<style>
body { display:none; background:#f8f9fa; font-family:"Segoe UI",Tahoma,sans-serif;}
.bg-custom { background: linear-gradient(135deg,#6f86d6 0%,#48c6ef 100%); }
.list-card { background:#fff; border-radius:10px; padding:15px; box-shadow:0 2px 6px rgba(0,0,0,0.06); }
</style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-custom">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">⚙️ ניהול סוגי הכנסה</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">🏠 דף ראשי</a></li>
                    <li class="nav-item"><a class="nav-link" href="commitments.html">💼 התחייבויות</a></li>
                    <li class="nav-item"><a class="nav-link" href="payments.html">💸 תשלומים</a></li>
                    <li class="nav-item"><a class="nav-link" href="summary.html">📑 סיכום כולל</a></li>
                    <li class="nav-item"><a class="nav-link active" href="manage.html">⚙️ ניהול סוגי הכנסה</a></li>
                    <li class="nav-item"><a class="nav-link" href="users.html">👥 ניהול משתמשים</a></li>
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">📊 דוחות</a></li>
                    <li class="nav-item"><a class="nav-link" href="permissions.html">🔐 הרשאות</a></li>
                    <li class="nav-item">
                        <span id="firebaseStatus" class="nav-link text-warning" title="לא מחובר ל-Firebase">
                            <i class="bi bi-cloud-slash"></i>
                        </span>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

<div class="container py-4">
  <div class="list-card">
    <h3>⚙️ רשימת סוגי הכנסה</h3>
    <p class="text-muted">ערוך את הרשימה — היא תשמש את שדות "סוג הכנסה" בדפי התשלומים וההתחייבויות.</p>

    <div class="mb-3 d-flex gap-2">
      <input id="newType" class="form-control" placeholder="הזן סוג הכנסה חדש">
      <button id="addTypeBtn" class="btn btn-primary">הוסף</button>
    </div>

    <ul id="typesList" class="list-group mb-3"></ul>

    <button id="resetDefaults" class="btn btn-outline-secondary">איפוס לסוגי ברירת מחדל</button>
  </div>
</div>

<script>
$(function(){
  const KEY = 'incomeTypes';
  const defaultTypes = ["תרומה","קידוש","עליית לתורה","תשלום חוב","תרומת ספונסר"];

  function load(){
    const arr = JSON.parse(localStorage.getItem(KEY) || "[]");
    render(arr);
  }

  function render(arr){
    const ul = $("#typesList").empty();
    if(arr.length===0) ul.append('<li class="list-group-item text-muted">(לא הוגדרו סוגים)</li>');
    arr.forEach((v,idx)=>{
      const li = $(`
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div class="flex-fill">
            <input class="form-control form-control-sm type-input" data-idx="${idx}" value="${v}">
          </div>
          <div class="ms-2">
            <button class="btn btn-sm btn-danger remove-btn" data-idx="${idx}"><i class="bi bi-trash"></i></button>
          </div>
        </li>
      `);
      ul.append(li);
    });
    // attach handlers
    $(".remove-btn").click(function(){
      const idx = Number($(this).data('idx'));
      let arr = JSON.parse(localStorage.getItem(KEY) || "[]");
      arr.splice(idx,1);
      localStorage.setItem(KEY, JSON.stringify(arr));
      updateAllPages();
      load();
    });
    $(".type-input").on("change", function(){
      const idx = Number($(this).data('idx'));
      let arr = JSON.parse(localStorage.getItem(KEY) || "[]");
      arr[idx] = $(this).val();
      localStorage.setItem(KEY, JSON.stringify(arr));
      updateAllPages();
      load();
    });
  }

  $("#addTypeBtn").click(function(){
    const val = $("#newType").val().trim();
    if(!val) return alert("הזן שם סוג הכנסה");
    let arr = JSON.parse(localStorage.getItem(KEY) || "[]");
    arr.push(val);
    localStorage.setItem(KEY, JSON.stringify(arr));
    $("#newType").val('');
    updateAllPages();
    load();
  });

  $("#resetDefaults").click(function(){
    if(!confirm('לאפס לרשימת ברירת מחדל?')) return;
    localStorage.setItem(KEY, JSON.stringify(defaultTypes));
    updateAllPages();
    load();
  });

  function updateAllPages(){
    // כתיבה ל־localStorage כבר מספיקה; דפי התשלומים וההתחייבויות מאזינים לאירוע storage
    window.dispatchEvent(new Event('storage')); // לעזור לעמוד הנוכחי לעדכן
  }

  // אם אין בכלל סוגים — אתחל דיפולט
  if(!localStorage.getItem(KEY)) localStorage.setItem(KEY, JSON.stringify(defaultTypes));

  load();
  $("body").fadeIn(200);
});
</script>

</body>
</html>
